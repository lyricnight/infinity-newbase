package club.lyric.infinity.impl.modules.exploit;

import club.lyric.infinity.api.module.Category;
import club.lyric.infinity.api.module.ModuleBase;
import club.lyric.infinity.api.setting.settings.NumberSetting;
import club.lyric.infinity.api.util.client.math.StopWatch;
import club.lyric.infinity.api.util.client.nulls.Null;
import club.lyric.infinity.manager.Managers;
import net.minecraft.network.packet.c2s.play.RequestCommandCompletionsC2SPacket;

/**
 * @author lyric
 */
public final class FastLatency extends ModuleBase {

    public NumberSetting delay =
            new NumberSetting(
                    "Delay",
                    this,
                    500,
                    0,
                    5000,
                    100,
                    "ms"
            );

    public FastLatency() {
        super("FastLatency", "Handles latency.", Category.EXPLOIT);
    }

    private final StopWatch.Single stopWatch = new StopWatch.Single();

    @Override
    public void onTickPre() {
        if (Null.is()) return;
        if (stopWatch.hasBeen(delay.getIValue())) {
            sendUnsafe(new RequestCommandCompletionsC2SPacket(1337, "w "));
            Managers.SERVER.setResponseTime(System.currentTimeMillis());
            stopWatch.reset();
        }
    }

    @Override
    public String moduleInformation() {
        return Managers.SERVER.getPing() + "ms";
    }
}
