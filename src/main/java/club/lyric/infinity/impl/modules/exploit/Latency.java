package club.lyric.infinity.impl.modules.exploit;

import club.lyric.infinity.api.module.Category;
import club.lyric.infinity.api.module.ModuleBase;
import club.lyric.infinity.api.setting.settings.NumberSetting;
import club.lyric.infinity.api.util.client.chat.ChatUtils;
import club.lyric.infinity.api.util.client.math.StopWatch;
import club.lyric.infinity.manager.Managers;
import net.minecraft.network.packet.c2s.play.RequestCommandCompletionsC2SPacket;

/**
 * @author lyric
 */
public class Latency extends ModuleBase {

    @SuppressWarnings("unchecked")
    public NumberSetting<Integer> delay = createNumber(
            new NumberSetting<>(
                    "Delay",
                    500,
                    0,
                    5000,
                    "Delay in ms between sending our packet to check our ping."
            ));

    public Latency()
    {
        super("Latency", "Handles latency.", Category.EXPLOIT);
    }

    private final StopWatch.Single stopWatch = new StopWatch.Single();

    @Override
    public void onTick()
    {
        if(nullCheck()) return;
        if (stopWatch.hasBeen(delay.getValue()))
        {
            send(new RequestCommandCompletionsC2SPacket(1337, "w "));
            Managers.SERVER.responseTime = System.currentTimeMillis();
            stopWatch.reset();
        }
        ChatUtils.sendOverwriteMessage("Ping: " + Managers.SERVER.getFastLatencyPing() + " " + "TPS: " + Managers.SERVER.getOurTPS(), 349);
    }
}
